<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>O Menino do Pijama Listrado - Jogo</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #2c3e50);
            color: #f0f0f0;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 20px 0;
            margin-bottom: 30px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            color: #f8f9fa;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 700px;
            margin: 0 auto;
        }
        
        .content {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .instructions {
            flex: 1;
            min-width: 300px;
            background: rgba(30, 40, 80, 0.7);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .instructions h2 {
            color: #ffd166;
            margin-bottom: 20px;
            font-size: 1.8rem;
            border-bottom: 2px solid #ffd166;
            padding-bottom: 10px;
        }
        
        .instructions-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .instruction-card {
            background: rgba(20, 30, 70, 0.6);
            border-radius: 10px;
            padding: 18px;
            transition: transform 0.3s;
        }
        
        .instruction-card:hover {
            transform: translateY(-5px);
            background: rgba(25, 35, 85, 0.8);
        }
        
        .instruction-card h3 {
            color: #06d6a0;
            margin-bottom: 10px;
            font-size: 1.3rem;
        }
        
        .instruction-card p {
            line-height: 1.6;
            font-size: 1.05rem;
        }
        
        .game-section {
            flex: 2;
            min-width: 500px;
            background: rgba(30, 30, 60, 0.7);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .game-section h2 {
            color: #ffd166;
            margin-bottom: 20px;
            font-size: 1.8rem;
            border-bottom: 2px solid #ffd166;
            padding-bottom: 10px;
        }
        
        .game-container {
            background: rgba(0, 0, 20, 0.8);
            border-radius: 10px;
            padding: 20px;
            min-height: 400px;
            font-family: monospace;
            font-size: 1.1rem;
            line-height: 1.6;
            overflow-y: auto;
            max-height: 500px;
            color: #e0e0ff;
            border: 1px solid #444;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.7);
        }
        
        .game-input {
            display: flex;
            margin-top: 20px;
        }
        
        .game-input input {
            flex: 1;
            padding: 12px 15px;
            background: rgba(0, 0, 30, 0.8);
            border: 1px solid #555;
            border-radius: 5px 0 0 5px;
            color: #f0f0ff;
            font-size: 1.1rem;
            outline: none;
        }
        
        .game-input button {
            padding: 12px 25px;
            background: #118ab2;
            color: white;
            border: none;
            border-radius: 0 5px 5px 0;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
        }
        
        .game-input button:hover {
            background: #06d6a0;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .btn {
            flex: 1;
            padding: 15px;
            background: rgba(40, 50, 120, 0.8);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn:hover {
            background: rgba(60, 80, 180, 0.9);
            transform: translateY(-3px);
        }
        
        .btn i {
            font-size: 1.3rem;
        }
        
        .btn-run {
            background: linear-gradient(135deg, #06d6a0, #118ab2);
        }
        
        .btn-run:hover {
            background: linear-gradient(135deg, #05c191, #0d7a9c);
        }
        
        .btn-reset {
            background: linear-gradient(135deg, #ef476f, #ff9e00);
        }
        
        .btn-reset:hover {
            background: linear-gradient(135deg, #d43c5f, #e68e00);
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            background: rgba(0, 0, 30, 0.7);
            padding: 12px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 1.1rem;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .theme-icon {
            color: #ffd166;
            font-size: 1.3rem;
        }
        
        footer {
            text-align: center;
            padding: 30px 0;
            margin-top: 30px;
            border-top: 2px solid rgba(255, 255, 255, 0.2);
            font-size: 1.1rem;
            opacity: 0.8;
        }
        
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            text-align: center;
        }
        
        .spinner {
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 5px solid #06d6a0;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .game-output-text {
            margin-bottom: 10px;
            white-space: pre-wrap;
        }
        
        .actions-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .action-btn {
            padding: 10px 15px;
            background: rgba(40, 50, 120, 0.8);
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
            flex: 1;
            min-width: 120px;
            font-size: 1rem;
        }
        
        .action-btn:hover {
            background: rgba(60, 80, 180, 0.9);
            transform: translateY(-2px);
        }
        
        .additional-info {
            background: rgba(20, 30, 60, 0.7);
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .info-section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .info-section:last-child {
            border-bottom: none;
        }
        
        .info-section h2 {
            color: #ffd166;
            margin-bottom: 15px;
            font-size: 1.8rem;
        }
        
        .info-content {
            display: flex;
            gap: 20px;
            margin-top: 15px;
        }
        
        .info-text {
            flex: 1;
        }
        
        .info-image {
            flex: 1;
            max-width: 300px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .book-cover {
            background: linear-gradient(135deg, #8b0000, #5a0000);
            color: white;
            padding: 20px;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            font-family: 'Georgia', serif;
        }
        
        .book-cover h3 {
            font-size: 1.8rem;
            font-weight: bold;
            line-height: 1.2;
            margin-bottom: 10px;
            text-transform: uppercase;
        }
        
        .book-cover p {
            font-size: 1.4rem;
            font-weight: bold;
            margin-top: 20px;
        }
        
        .movie-poster {
            background: linear-gradient(135deg, #1a3a5f, #0a2a4f);
            color: white;
            padding: 20px;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            font-family: 'Arial', sans-serif;
        }
        
        .movie-poster h3 {
            font-size: 2.2rem;
            font-weight: bold;
            line-height: 1.1;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .credits {
            background: rgba(20, 30, 60, 0.7);
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            text-align: center;
        }
        
        .credits h2 {
            color: #ffd166;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }
        
        .credits-content {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .credit-card {
            background: rgba(30, 40, 80, 0.6);
            border-radius: 10px;
            padding: 20px;
            flex: 1;
            min-width: 250px;
            max-width: 300px;
        }
        
        .credit-card h3 {
            color: #06d6a0;
            margin-bottom: 10px;
            font-size: 1.4rem;
        }
        
        .credit-card p {
            margin-bottom: 10px;
            line-height: 1.6;
        }
        
        .emoji {
            font-size: 1.2rem;
            margin: 0 3px;
        }
        
        @media (max-width: 768px) {
            .content {
                flex-direction: column;
            }
            
            .game-section, .instructions {
                min-width: 100%;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .info-content {
                flex-direction: column;
            }
            
            .info-image {
                max-width: 100%;
                height: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>O Menino do Pijama Listrado</h1>
            <p class="subtitle">Um jogo narrativo sobre amizade e empatia em tempos de guerra</p>
        </header>
        
        <div class="content">
            <section class="instructions">
                <h2><i class="fas fa-book-open"></i> Instruções do Jogo</h2>
                <div class="instructions-content">
                    <div class="instruction-card">
                        <h3><i class="fas fa-user"></i> Personagem Principal</h3>
                        <p>Você joga como Bruno, um garoto alemão de 9 anos que se muda com a família para um local misterioso chamado Havenscott durante a Segunda Guerra Mundial.</p>
                    </div>
                    
                    <div class="instruction-card">
                        <h3><i class="fas fa-bullseye"></i> Objetivo do Jogo</h3>
                        <p>Construir uma amizade verdadeira com Shmuel, um menino do outro lado da cerca, e tomar decisões que afetam o desfecho da história.</p>
                    </div>
                    
                    <div class="instruction-card">
                        <h3><i class="fas fa-gamepad"></i> Controles</h3>
                        <p>- Botões de ação: Escolher ações e respostas<br>
                        - Diário: Digitar para escrever suas memórias</p>
                    </div>
                    
                    <div class="instruction-card">
                        <h3><i class="fas fa-play-circle"></i> Como Jogar</h3>
                        <p>1. Explore a casa e os arredores de Havenscott.<br>
                        2. Interaja com sua família e com Shmuel.<br>
                        3. Tome decisões que afetam o humor, amizade e história.<br>
                        4. Alimente e ajude Shmuel para fortalecer a relação.<br>
                        5. Registre tudo no Diário de Bruno.</p>
                    </div>
                    
                    <div class="instruction-card">
                        <h3><i class="fas fa-trophy"></i> Finais Possíveis</h3>
                        <p>Seu final depende das decisões que tomar, do nível de amizade com Shmuel, de quantos dias restam e de quais eventos você desbloqueou.</p>
                    </div>
                </div>
            </section>
            
            <section class="game-section">
                <h2><i class="fas fa-terminal"></i> Jogar</h2>
                
                <div class="status-bar">
                    <div class="status-item">
                        <i class="fas fa-heart theme-icon"></i>
                        <span>Status: <span id="game-status">Pronto para jogar</span></span>
                    </div>
                    <div class="status-item">
                        <i class="fas fa-history theme-icon"></i>
                        <span>Engine: <span id="pyodide-status">JavaScript</span></span>
                    </div>
                </div>
                
                <div class="game-container" id="game-output">
                    <div class="loading" id="loading-screen">
                        <div class="spinner"></div>
                        <p>Carregando o jogo...</p>
                    </div>
                </div>
                
                <div id="actions-container" class="actions-container">
                    <!-- Botões de ação serão inseridos aqui dinamicamente -->
                </div>
                
                <div class="game-input">
                    <input type="text" id="game-input" placeholder="Digite sua ação aqui..." disabled>
                    <button id="send-command" disabled><i class="fas fa-paper-plane"></i> Enviar</button>
                </div>
                
                <div class="controls">
                    <button class="btn btn-run" id="run-game"><i class="fas fa-play"></i> Iniciar Jogo</button>
                    <button class="btn" id="show-help"><i class="fas fa-question-circle"></i> Ajuda</button>
                    <button class="btn btn-reset" id="reset-game"><i class="fas fa-redo"></i> Reiniciar</button>
                </div>
            </section>
        </div>
        
        <section class="additional-info">
            <div class="info-section">
                <h2><i class="fas fa-book"></i> O Livro</h2>
                <div class="info-content">
                    <div class="info-text">
                        <p><span class="emoji">📖</span> "O Menino do Pijama Listrado" é um romance escrito pelo autor irlandês John Boyne, publicado em 2006.</p>
                        <p><span class="emoji">👦</span> O livro conta a história de Bruno, um menino de 9 anos, filho de um oficial nazista que é transferido para trabalhar em um campo de concentração durante a Segunda Guerra Mundial.</p>
                        <p><span class="emoji">🤝</span> A narrativa explora a inocência infantil diante do Holocausto, quando Bruno faz amizade com Shmuel, um menino judeu que vive do outro lado da cerca do campo.</p>
                        <p><span class="emoji">🎭</span> A obra aborda temas sensíveis como preconceito, amizade e as consequências da guerra, tudo através da perspectiva ingênua de uma criança.</p>
                        <p><span class="emoji">🏆</span> O livro tornou-se um best-seller internacional, traduzido para mais de 50 idiomas e vendeu milhões de cópias em todo o mundo.</p>
                    </div>
                    <div class="info-image">
                        <div class="book-cover">
                            <h3>O menino</h3>
                            <h3>do</h3>
                            <h3>pijama</h3>
                            <h3>listrado</h3>
                            <p>JOHN BOYNE</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="info-section">
                <h2><i class="fas fa-film"></i> O Filme</h2>
                <div class="info-content">
                    <div class="info-text">
                        <p><span class="emoji">🎬</span> Em 2008, o livro foi adaptado para o cinema com direção de Mark Herman.</p>
                        <p><span class="emoji">🌟</span> O filme conta com as atuações de Asa Butterfield (Bruno), Jack Scanlon (Shmuel), Vera Farmiga (mãe) e David Thewlis (pai).</p>
                        <p><span class="emoji">🎭</span> A adaptação mantém a perspectiva infantil da história original, mostrando o Holocausto através dos olhos inocentes de Bruno.</p>
                        <p><span class="emoji">💔</span> O filme foi aclamado pela crítica por sua abordagem sensível e emocionante, com destaque para as atuações dos jovens protagonistas.</p>
                        <p><span class="emoji">🏆</span> Recebeu várias indicações a prêmios, incluindo o BAFTA de Melhor Filme Britânico e vários prêmios de cinema internacional.</p>
                    </div>
                    <div class="info-image">
                        <div class="movie-poster">
                            <h3>THE</h3>
                            <h3>BOY</h3>
                            <h3>IN THE</h3>
                            <h3>STRIPED</h3>
                            <h3>PAJAMAS</h3>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <section class="credits">
            <h2><i class="fas fa-users"></i> Créditos</h2>
            <div class="credits-content">
                <div class="credit-card">
                    <h3>Desenvolvimento do Jogo</h3>
                    <p><span class="emoji">👨‍💻</span> André: Desenvolveu a parte do site e instruções</p>
                    <p><span class="emoji">🎮</span> Enzo: Desenvolveu a parte do jogo</p>
                </div>
                
                <div class="credit-card">
                    <h3>Trabalho Escolar</h3>
                    <p><span class="emoji">🏫</span> Escola: Ulbra Palmas</p>
                    <p><span class="emoji">📍</span> Local: Palmas - TO</p>
                    <p><span class="emoji">👨‍🎓</span> Turma: 8° Ano</p>
                    <p><span class="emoji">📚</span> Projeto: Apresentação sobre o livro</p>
                </div>
            </div>
        </section>
        
        <footer>
            <p>Jogo desenvolvido com JavaScript | Baseado no livro "O Menino do Pijama Listrado"</p>
            <p>⚠ Este jogo aborda temas sensíveis da Segunda Guerra Mundial com foco educacional</p>
        </footer>
    </div>

    <script>
        // Elementos do DOM
        const gameOutput = document.getElementById('game-output');
        const gameInput = document.getElementById('game-input');
        const sendCommand = document.getElementById('send-command');
        const runGame = document.getElementById('run-game');
        const resetGame = document.getElementById('reset-game');
        const showHelp = document.getElementById('show-help');
        const gameStatus = document.getElementById('game-status');
        const pyodideStatus = document.getElementById('pyodide-status');
        const loadingScreen = document.getElementById('loading-screen');
        const actionsContainer = document.getElementById('actions-container');
        
        // Estados do jogo
        const Estado = {
            CASA_BERLIM: 1,
            HAVENSCOTT: 2,
            JANELA: 3,
            CERCA: 4,
            EXPLORACAO: 5,
            FINAL: 6,
            DIARIO: 7
        };
        
        const Humor = {
            FELIZ: 1,
            TRISTE: 2,
            COM_MEDO: 3,
            CURIOSO: 4,
            CONFUSO: 5
        };
        
        const Relacao = {
            ESTRANHO: 0,
            CONHECIDO: 1,
            AMIGO: 2,
            MELHOR_AMIGO: 3
        };
        
        // Emojis para formatação do texto
        const emojis = {
            "Bruno": "👦",
            "Shmuel": "👦",
            "Pai": "👨",
            "Mãe": "👩",
            "Gretel": "👧",
            "Berlim": "🏙️",
            "Havenscott": "🏠",
            "cerca": "🚧",
            "pazinha": "⛏️",
            "bola": "⚽",
            "pão": "🍞",
            "queijo": "🧀",
            "maçã": "🍎",
            "chocolate": "🍫",
            "diário": "📖",
            "feliz": "😊",
            "triste": "😢",
            "medo": "😨",
            "curioso": "🤔",
            "confuso": "😕",
            "amizade": "👬"
        };
        
        // Função para adicionar emojis ao texto
        function formatarComEmojis(texto) {
            let textoFormatado = texto;
            for (const [palavra, emoji] of Object.entries(emojis)) {
                const regex = new RegExp(`\\b${palavra}\\b`, 'gi');
                textoFormatado = textoFormatado.replace(regex, `${emoji} ${palavra}`);
            }
            return textoFormatado;
        }
        
        // Classes do jogo
        class Item {
            constructor(nome, descricao, usos = 1) {
                this.nome = nome;
                this.descricao = descricao;
                this.usos = usos;
            }
            
            usar() {
                if (this.usos > 0) {
                    this.usos--;
                    return true;
                }
                return false;
            }
        }
        
        class Personagem {
            constructor(nome, descricao) {
                this.nome = nome;
                this.descricao = descricao;
                this.relacao = Relacao.ESTRANHO;
                this.dialogo = {};
                this.humor = Humor.CURIOSO;
                this.conhecido = false;
            }
            
            mudarHumor(novo_humor) {
                this.humor = novo_humor;
            }
            
            adicionarDialogo(humor, frases) {
                this.dialogo[humor] = frases;
            }
            
            falar() {
                if (this.dialogo[this.humor]) {
                    const frases = this.dialogo[this.humor];
                    return frases[Math.floor(Math.random() * frases.length)];
                }
                return "...";
            }
        }
        
        class Diario {
            constructor() {
                this.entradas = [];
                this.paginas = [
                    "Capa: Diário de Bruno",
                    "Página 1: Hoje nos mudamos para Havenscott...",
                    "Página 2: Há uma cerca estranha aqui...",
                    "Página 3: Conheci um menino chamado Shmuel..."
                ];
            }
            
            adicionarEntrada(texto) {
                const data = new Date(1943, 5, 1); // Junho de 1943
                data.setDate(data.getDate() + (30 - jogo.bruno.diasRestantes));
                const entrada = `${data.getDate()}/${data.getMonth() + 1}/${data.getFullYear()}: ${texto}`;
                this.entradas.push(entrada);
            }
        }
        
        class Bruno {
            constructor() {
                this.inventario = [];
                this.relacaoShmuel = Relacao.ESTRANHO;
                this.diasRestantes = 30;
                this.visitouJanela = false;
                this.conheceuShmuel = false;
                this.pegouPazinha = false;
                this.diasConsecutivosAmizade = 0;
                this.humor = Humor.CURIOSO;
                this.fomeShmuel = 0;
                this.energia = 100;
                this.diario = new Diario();
                this.eventosVistos = new Set();
                this.itensEntregues = new Set();
            }
            
            adicionarItem(item) {
                this.inventario.push(item);
                this.adicionarSaida(`\n> ${item.nome} adicionado ao inventário: ${item.descricao}`);
            }
            
            verInventario() {
                this.adicionarSaida("\n=== INVENTÁRIO ===");
                if (this.inventario.length === 0) {
                    this.adicionarSaida("Vazio");
                    return false;
                }
                
                for (let i = 0; i < this.inventario.length; i++) {
                    const item = this.inventario[i];
                    const usos = item.usos > 1 ? ` (${item.usos} usos)` : '';
                    this.adicionarSaida(`${i + 1} - ${item.nome}${usos}: ${item.descricao}`);
                }
                return true;
            }
            
            usarItem(index) {
                try {
                    const idx = parseInt(index) - 1;
                    if (idx >= 0 && idx < this.inventario.length) {
                        const item = this.inventario[idx];
                        if (item.usar()) {
                            this.adicionarSaida(`\nVocê usou ${item.nome}`);
                            if (item.usos === 0) {
                                this.adicionarSaida(`${item.nome} se esgotou!`);
                                this.inventario.splice(idx, 1);
                            }
                            return item;
                        } else {
                            this.adicionarSaida(`\n${item.nome} não pode ser usado mais`);
                        }
                    } else {
                        this.adicionarSaida("\nÍtem inválido");
                    }
                } catch (error) {
                    this.adicionarSaida("\nEscolha inválida");
                }
                return null;
            }
            
            mudarHumor(novo_humor) {
                const humores = ["Feliz 😊", "Triste 😢", "Com medo 😨", "Curioso 🤔", "Confuso 😕"];
                this.adicionarSaida(`\nSeu humor mudou de ${humores[this.humor - 1]} para ${humores[novo_humor - 1]}`);
                this.humor = novo_humor;
            }
            
            passarDia(dias = 1) {
                this.diasRestantes -= dias;
                this.energia = Math.min(100, this.energia + 30);
                
                if (this.relacaoShmuel > 0) {
                    this.fomeShmuel += 10;
                    if (this.fomeShmuel > 50) {
                        this.relacaoShmuel = Math.max(Relacao.ESTRANHO, this.relacaoShmuel - 1);
                        this.adicionarSaida("\nShmuel está com muita fome! Sua amizade diminuiu.");
                    }
                }
                
                if (this.diasConsecutivosAmizade > 0) {
                    this.diasConsecutivosAmizade--;
                }
                
                return this.diasRestantes > 0;
            }
            
            aumentarAmizade(quantidade = 1) {
                this.relacaoShmuel = Math.min(Relacao.MELHOR_AMIGO, this.relacaoShmuel + quantidade);
                this.fomeShmuel = Math.max(0, this.fomeShmuel - 20);
                this.diasConsecutivosAmizade++;
                this.adicionarSaida(`\nSua amizade com Shmuel aumentou! Nível: ${this.relacaoShmuel} 👬`);
            }
            
            adicionarSaida(texto) {
                const p = document.createElement('p');
                p.className = 'game-output-text';
                p.innerHTML = formatarComEmojis(texto);
                gameOutput.appendChild(p);
                gameOutput.scrollTop = gameOutput.scrollHeight;
            }
        }
        
        class Jogo {
            constructor() {
                this.estadoAtual = Estado.CASA_BERLIM;
                this.bruno = new Bruno();
                this.shmuel = new Personagem("Shmuel", "Um menino magro usando um pijama listrado");
                this.personagens = {
                    "pai": new Personagem("Pai", "Comandante militar alemão"),
                    "mãe": new Personagem("Mãe", "Preocupada com a mudança"),
                    "irmã": new Personagem("Gretel", "Irmã mais velha de Bruno")
                };
                
                this.configurarDialogos();
                this.configurarItens();
                this.eventos = [];
                this.eventoAtual = 0;
                this.configurarEventos();
                
                // Configurar estado inicial
                this.bruno.mudarHumor(Humor.TRISTE);
                this.bruno.adicionarItem(new Item("Bola", "Uma bola de couro", 5));
            }
            
            configurarDialogos() {
                // Configurar diálogos de Shmuel
                this.shmuel.adicionarDialogo(Humor.FELIZ, [
                    "Hoje é um dia bom... o sol está brilhando ☀️",
                    "Obrigado pela comida, Bruno 🙏",
                    "Você é meu único amigo aqui 👬"
                ]);
                
                this.shmuel.adicionarDialogo(Humor.TRISTE, [
                    "Tenho saudades da minha família... 😢",
                    "Estou com fome... 🍽️",
                    "Por que as pessoas são tão más? 😔"
                ]);
                
                this.shmuel.adicionarDialogo(Humor.CURIOSO, [
                    "Como é Berlim? 🏙️",
                    "O que você faz na sua casa? 🏠",
                    "Você tem muitos amigos? 👦"
                ]);
                
                // Configurar diálogos do pai
                this.personagens["pai"].adicionarDialogo(Humor.FELIZ, [
                    "Estamos fazendo um importante trabalho aqui 👨‍✈️",
                    "Você vai gostar de Havenscott, Bruno 🏠"
                ]);
                
                this.personagens["pai"].adicionarDialogo(Humor.CONFUSO, [
                    "Por que você está sempre explorando? 🧭",
                    "Não se aproxime da cerca, Bruno ⚠️"
                ]);
                
                // Configurar diálogos da mãe
                this.personagens["mãe"].adicionarDialogo(Humor.COM_MEDO, [
                    "Este não é um lugar para crianças 👶",
                    "Talvez devêssemos voltar para Berlim 🏙️"
                ]);
            }
            
            configurarItens() {
                this.itens = {
                    "maçã": new Item("Maçã", "Uma maçã vermelha e suculenta 🍎", 1),
                    "pão": new Item("Pão", "Um pedaço de pão fresco 🍞", 1),
                    "queijo": new Item("Queijo", "Um pedaço de queijo 🧀", 1),
                    "chocolate": new Item("Chocolate", "Barra de chocolate 🍫", 1),
                    "pazinha": new Item("Pazinha", "Pequena pá para cavar ⛏️", 3),
                    "cordão": new Item("Cordão", "Pedacinho de corda 🧵", 2)
                };
            }
            
            configurarEventos() {
                this.eventos = [
                    {
                        nome: "Mudança para Havenscott",
                        descricao: "Chegamos hoje em Havenscott. A casa é muito menor que a de Berlim e não tem lugar para explorar. Estou triste. 😢",
                        acoes: ["Explorar a casa 🏠", "Olhar pela janela 👀", "Falar com a mãe 👩"],
                        consequencias: [
                            () => { 
                                this.bruno.adicionarItem(this.itens["pazinha"]); 
                                return { mensagem: "Você encontrou uma pazinha no porão! ⛏️" };
                            },
                            () => { 
                                this.bruno.visitouJanela = true; 
                                return { mensagem: "Você vê uma cerca distante e pessoas usando pijamas listrados. 🚧" };
                            },
                            () => { 
                                this.bruno.mudarHumor(Humor.CONFUSO); 
                                return { mensagem: "Mãe diz: 'Este não é um lugar para crianças, Bruno.' 👩" };
                            }
                        ]
                    },
                    {
                        nome: "Primeiro encontro",
                        descricao: "Enquanto explorava, encontrei um menino do outro lado da cerca. Ele parece triste e usa um pijama listrado. 👦",
                        acoes: ["Apresentar-se 👋", "Perguntar por que ele está triste 😢", "Oferecer comida 🍎"],
                        consequencias: [
                            () => { 
                                this.bruno.conheceuShmuel = true; 
                                this.bruno.relacaoShmuel = Relacao.CONHECIDO; 
                                return { mensagem: "Meu nome é Bruno. E o seu? - Shmuel, ele respondeu. 👦" };
                            },
                            () => { 
                                this.shmuel.mudarHumor(Humor.TRISTE);
                                return { mensagem: "Shmuel: 'Sinto falta da minha família...' 😢" };
                            },
                            () => { 
                                if (this.bruno.inventario.some(item => ["maçã", "pão", "queijo", "chocolate"].includes(item.nome))) {
                                    const comida = this.bruno.inventario.find(item => ["maçã", "pão", "queijo", "chocolate"].includes(item.nome));
                                    this.bruno.usarItem(this.bruno.inventario.indexOf(comida) + 1);
                                    this.bruno.aumentarAmizade();
                                    return { mensagem: "Shmuel sorriu ao receber a comida! 😊" };
                                } else {
                                    return { mensagem: "Você não tem comida para oferecer! 😢" };
                                }
                            }
                        ]
                    },
                    {
                        nome: "A amizade cresce",
                        descricao: "Você tem visitado Shmuel regularmente. Hoje ele parece mais fraco que o normal. 😔",
                        acoes: ["Conversar com Shmuel 💬", "Procurar mais comida 🔍", "Cavar sob a cerca ⛏️"],
                        consequencias: [
                            () => { 
                                this.bruno.aumentarAmizade();
                                return { mensagem: "Shmuel: 'É bom ter alguém para conversar...' 👦" };
                            },
                            () => { 
                                this.bruno.adicionarItem(this.itens["pão"]);
                                return { mensagem: "Você encontrou um pedaço de pão na cozinha! 🍞" };
                            },
                            () => { 
                                if (this.bruno.inventario.some(item => item.nome === "pazinha")) {
                                    this.bruno.usarItem(this.bruno.inventario.findIndex(item => item.nome === "pazinha") + 1);
                                    return { mensagem: "Você cavou um pequeno túnel sob a cerca! ⛏️" };
                                } else {
                                    return { mensagem: "Você não tem uma pazinha para cavar! 😕" };
                                }
                            }
                        ]
                    },
                    {
                        nome: "O plano de fuga",
                        descricao: "Shmuel disse que seu pai desapareceu. Ele está desesperado. 😢",
                        acoes: ["Confortar Shmuel 🤗", "Oferecer ajuda 🆘", "Ignorar o problema 😶"],
                        consequencias: [
                            () => { 
                                this.bruno.aumentarAmizade(2);
                                return { mensagem: "Shmuel se sentiu reconfortado com suas palavras. 🤗" };
                            },
                            () => { 
                                if (this.bruno.relacaoShmuel >= Relacao.AMIGO) {
                                    this.bruno.aumentarAmizade(3);
                                    return { mensagem: "Você prometeu ajudar Shmuel a encontrar seu pai. 🆘" };
                                } else {
                                    return { mensagem: "Shmuel não confia o suficiente em você para aceitar ajuda. 😔" };
                                }
                            },
                            () => { 
                                this.bruno.relacaoShmuel = Math.max(Relacao.ESTRANHO, this.bruno.relacaoShmuel - 1);
                                return { mensagem: "Shmuel se afastou triste. Você perdeu pontos de amizade. 😢" };
                            }
                        ]
                    },
                    {
                        nome: "Decisão final",
                        descricao: "Chegou o dia da sua partida. Shmuel pede para você entrar no campo para ajudá-lo a encontrar o pai. 😔",
                        acoes: ["Entrar no campo ⚠️", "Despedir-se de longe 👋", "Fingir que não ouviu 😶"],
                        consequencias: [
                            () => { 
                                this.bruno.diasRestantes = 0;
                                return { mensagem: "Você entrou no campo com Shmuel... ⚠️" };
                            },
                            () => { 
                                this.bruno.aumentarAmizade(1);
                                return { mensagem: "Você se despediu de Shmuel à distância. 👋" };
                            },
                            () => { 
                                this.bruno.relacaoShmuel = Relacao.ESTRANHO;
                                return { mensagem: "Shmuel nunca mais olhou para você. 😔" };
                            }
                        ]
                    }
                ];
            }
            
            async iniciar() {
                // Remover tela de carregamento
                loadingScreen.style.display = 'none';
                
                // Exibir introdução do jogo
                this.bruno.adicionarSaida("=== O MENINO DO PIJAMA LISTRADO ===");
                this.bruno.adicionarSaida("Berlim, 1943 🏙️");
                this.bruno.adicionarSaida("Você é Bruno, um garoto de 9 anos que está prestes a se mudar com sua família para um lugar chamado Havenscott.");
                this.bruno.adicionarSaida("Seu pai é um importante comandante militar e diz que o 'Führer' tem grandes planos para ele neste novo posto.");
                this.bruno.adicionarSaida("Você está triste por deixar seus amigos e sua grande casa em Berlim... 😢");
                
                // Iniciar primeiro evento
                await this.executarEvento(this.eventoAtual);
            }
            
            async executarEvento(index) {
                if (index >= this.eventos.length) {
                    this.finalizarJogo();
                    return;
                }
                
                const evento = this.eventos[index];
                this.bruno.adicionarSaida(`\n=== ${evento.nome.toUpperCase()} ===`);
                this.bruno.adicionarSaida(evento.descricao);
                
                // Mostrar ações disponíveis como botões
                this.mostrarBotoesAcao(evento.acoes, evento.consequencias, index);
            }
            
            mostrarBotoesAcao(acoes, consequencias, eventoIndex) {
                // Limpar container de ações
                actionsContainer.innerHTML = '';
                
                // Criar botões para cada ação
                acoes.forEach((acao, index) => {
                    const btn = document.createElement('button');
                    btn.className = 'action-btn';
                    btn.textContent = acao;
                    btn.onclick = async () => {
                        // Desativar botões durante o processamento
                        actionsContainer.innerHTML = '';
                        
                        // Executar consequência da ação
                        try {
                            const resultado = consequencias[index]();
                            if (resultado.mensagem) {
                                this.bruno.adicionarSaida(resultado.mensagem);
                            }
                            
                            // Passar para o próximo dia
                            const diaPassou = this.bruno.passarDia();
                            this.bruno.adicionarSaida(`\n--- Dia ${31 - this.bruno.diasRestantes} ---`);
                            this.bruno.adicionarSaida(`Dias restantes: ${this.bruno.diasRestantes} | Amizade com Shmuel: ${this.bruno.relacaoShmuel} 👬`);
                            
                            if (!diaPassou) {
                                this.finalizarJogo();
                                return;
                            }
                            
                            // Executar próximo evento
                            this.eventoAtual = eventoIndex + 1;
                            setTimeout(() => this.executarEvento(this.eventoAtual), 1000);
                        } catch (e) {
                            this.bruno.adicionarSaida("Ocorreu um erro: " + e.message);
                        }
                    };
                    actionsContainer.appendChild(btn);
                });
            }
            
            finalizarJogo() {
                let final = "";
                let emojiFinal = "";
                
                if (this.bruno.relacaoShmuel >= Relacao.MELHOR_AMIGO) {
                    final = "FINAL DA AMIZADE VERDADEIRA 👬\nVocê e Shmuel se tornaram melhores amigos. Mesmo com todas as dificuldades, sua amizade transcendeu a cerca.";
                    emojiFinal = "👬❤️";
                } else if (this.bruno.relacaoShmuel >= Relacao.AMIGO) {
                    final = "FINAL DA ESPERANÇA ✨\nVocês se tornaram amigos, mas a guerra continuou a separá-los.";
                    emojiFinal = "✨🤝";
                } else {
                    final = "FINAL SOLITÁRIO 😢\nOs dias passaram e você não conseguiu construir uma amizade com Shmuel.";
                    emojiFinal = "😢🌫️";
                }
                
                this.bruno.adicionarSaida("\n=== FIM DO JOGO ===");
                this.bruno.adicionarSaida(final);
                this.bruno.adicionarSaida(emojiFinal);
                this.bruno.adicionarSaida("\nObrigado por jogar 'O Menino do Pijama Listrado'");
                
                // Desativar ações
                actionsContainer.innerHTML = '';
            }
        }
        
        // Variável global do jogo
        let jogo;
        
        // Inicializar o jogo quando o botão for clicado
        runGame.addEventListener('click', () => {
            // Atualizar status
            gameStatus.textContent = "Jogando...";
            gameInput.disabled = false;
            sendCommand.disabled = false;
            
            // Remover tela de carregamento
            loadingScreen.style.display = 'none';
            
            // Criar nova instância do jogo
            jogo = new Jogo();
            
            // Iniciar o jogo
            jogo.iniciar();
        });
        
        // Reiniciar o jogo
        resetGame.addEventListener('click', () => {
            gameOutput.innerHTML = '<div class="loading" id="loading-screen"><div class="spinner"></div><p>Carregando o jogo...</p></div>';
            actionsContainer.innerHTML = '';
            gameInput.value = '';
            gameInput.disabled = true;
            sendCommand.disabled = true;
            gameStatus.textContent = "Pronto para jogar";
            loadingScreen.style.display = 'flex';
        });
        
        // Mostrar ajuda
        showHelp.addEventListener('click', () => {
            alert("Use os botões para selecionar ações. Escreva no diário para registrar seus pensamentos.");
        });
        
        // Configurar envio de comandos
        gameInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendCommand.click();
            }
        });
        
        sendCommand.addEventListener('click', () => {
            if (gameInput.value.trim() !== '') {
                const inputValue = gameInput.value.trim();
                gameInput.value = '';
                
                // Adicionar entrada do usuário ao output
                const p = document.createElement('p');
                p.className = 'game-output-text';
                p.innerHTML = `<span style="color:#ffd166">&gt; </span>${inputValue}`;
                gameOutput.appendChild(p);
                gameOutput.scrollTop = gameOutput.scrollHeight;
                
                // Adicionar ao diário
                if (jogo && jogo.bruno) {
                    jogo.bruno.diario.adicionarEntrada(inputValue);
                    jogo.bruno.adicionarSaida("> Entrada adicionada ao diário 📖");
                }
            }
        });
    </script>
</body>
</html>